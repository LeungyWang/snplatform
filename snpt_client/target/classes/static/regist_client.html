<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>普通用户注册</title>
    <link rel="stylesheet" th:href="@{/assets/libs/layui/css/layui.css}"/>
    <link rel="stylesheet" th:href="@{/assets/module/admin.css?v=316}"/>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-form-item {
            margin-bottom: 25px;
        }

        @media screen and (max-width: 1060px) {
            .lay-step {
                padding-left: 50px !important;
            }
        }
    </style>
</head>
<body>
<!-- 加载动画 -->
<div class="page-loading">
    <div class="ball-loader">
        <span></span><span></span><span></span><span></span>
    </div>
</div>

<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body" style="padding-top: 40px;">

            <div class="layui-carousel" id="stepForm" lay-filter="stepForm" style="margin: 0 auto;">
                <div carousel-item>
                    <div><br>
                        <H2 style="text-align: center">普通用户注册</H2>
                        <form class="layui-form" style="margin: 0 auto;max-width: 460px;padding-top: 60px;">
                            <div class="layui-form-item">
                                <label class="layui-form-label layui-form-required">真实姓名:</label>
                                <div class="layui-input-block">
                                    <input type="text" name="name" placeholder="请输入真实姓名" class="layui-input"
                                           lay-verType="tips" lay-verify="required" required/>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label layui-form-required">身份证号:</label>
                                <div class="layui-input-block">
                                    <input type="text" name="idno" placeholder="请输入身份证号" class="layui-input"
                                           lay-verType="tips" lay-verify="idno" required/>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label layui-form-required">电话:</label>
                                <div class="layui-input-block">
                                    <input type="text" id="phone1" name="phone" placeholder="请输入您的电话" class="layui-input"
                                           lay-verType="tips" lay-verify="phone" required/>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label layui-form-required">邮箱地址:</label>
                                <div class="layui-input-block">
                                    <input type="email" name="email"  placeholder="请输入邮箱地址"
                                           class="layui-input"
                                           lay-verType="tips" lay-verify="email" required>
                                </div>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label layui-form-required">地址:</label>
                                <div class="layui-input-block">
                        <textarea name="address" placeholder="请输入您的地址" class="layui-textarea"
                                  lay-verType="tips" lay-verify="required" required></textarea>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn" lay-submit lay-filter="formDemo">&emsp;下一步&emsp;
                                    </button>
                                </div>
                            </div>
                        </form>

                    </div>
                    <div>

                        <form class="layui-form" style="margin: 0 auto;max-width: 460px;padding-top: 60px;">
                            <div class="layui-form-item">
                                <label class="layui-form-label layui-form-required">用户名:</label>
                                <div class="layui-input-block">
                                    <input type="text" name="username" placeholder="请输入用户名" class="layui-input"
                                           lay-verType="tips" lay-verify="username" required/>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label layui-form-required">昵称:</label>
                                <div class="layui-input-block">
                                    <input type="text" name="nickname" placeholder="请输入昵称" class="layui-input"
                                           lay-verType="tips" lay-verify="required" required/>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label layui-form-required">密码：</label>
                                <div class="layui-input-block">
                                    <input name="password" type="password" placeholder="密码" class="layui-input"
                                           lay-verType="tips" lay-verify="password" required/>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">性别:</label>
                                <div class="layui-input-inline" style="display: block;width: auto;float: none;">
                                    <input type="radio" name="sex" value="男" title="男" checked>
                                    <input type="radio" name="sex" value="女" title="女">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">电话:</label>
                                <div class="layui-input-block">
                                    <input type="text" id="L_phone" name="phone" placeholder="请输入您的电话" class="layui-input" readonly="true" />
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label for="L_pass" class="layui-form-label">手机验证码</label>

                                <div class="layui-input-block">
                                    <div class="layui-row inline-block">
                                        <div class="layui-col-xs7">
                                    <input type="password" id="L_pass" name="pass" required lay-verify="required" autocomplete="off" class="layui-input"/>
                                </div>
                                        <div class="layui-col-xs5" style="padding-left: 6px;">
                                            <button type="button" class="layui-btn" id="send_phone"><span id="send_str">发送手机验证码</span>&nbsp;&nbsp;<span id="p_djs">(<span id="djs">0</span>)</span></button>
                                </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
<!--                                    <button type="button" class="layui-btn layui-btn-primary pre">上一步</button>-->
                                    <button class="layui-btn" lay-submit lay-filter="formDemo2">&emsp;提交&emsp;
                                    </button>
                                </div>
                            </div>
                        </form>

                    </div>

                    <div>

                        <div style="text-align: center;margin-top: 90px;">
                            <i class="layui-icon layui-circle"
                               style="color: white;font-size:30px;font-weight:bold;background: #52C41A;padding: 20px;line-height: 80px;">&#xe605;</i>
                            <div style="font-size: 24px;color: #333;font-weight: 500;margin-top: 30px;">注册成功！
                            </div>
                            <div style="font-size: 14px;color: #666;margin-top: 20px;"></div>
                        </div>

                        <div style="text-align: center;margin-top: 50px;">
                            <button onclick="location.replace('/user/redirect/login')" class="layui-btn">登录</button>
                            <!--                            <button class="layui-btn layui-btn-primary">查看账单</button>-->
                        </div>

                    </div>

                </div>
            </div>



        </div>
    </div>
</div>

<!-- js部分 -->
<script type="text/javascript" th:src="@{/assets/libs/layui/layui.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/common.js?v=316}"></script>

<script>
    layui.use(['layer', 'form', 'step'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        var step = layui.step;

        step.render({
            elem: '#stepForm',
            filter: 'stepForm',
            width: '100%', //设置容器宽度
            stepWidth: '750px',
            height: '1000px',
            stepItems: [{
                title: '填写基本信息'
            }, {
                title: '填写账户信息'
            }, {
                title: '注册完成'
            }]
        });

        $("#p_djs").hide();

        function sendyzm(obj){
            var phone = $("#L_phone").val();
            if(phone) {
                $.ajax({
                    url:"/user/sendSms",
                    data:{mobile:phone},
                    dataType:"json",
                    type:"post",
                    async : false,
                    cache : false,
                    success:function(res){
                        // debugger;
                        if(res.code==200){
                            layer.msg("验证码发送成功",{icon:1});
                        }else{
                            layer.msg("验证码发送失败",{icon:2});
                        }
                    },
                    error:function(){
                        alert("验证码发送失败");
                    }
                });
                setTime(obj);//开始倒计时
            }
        }

        var countdown = 60;
        function setTime(obj) {
            if (countdown == 0) {
                obj.prop('disabled', false);
                obj.text("点击获取验证码");
                countdown = 60;//60秒过后button上的文字初始化,计时器初始化;
                return;
            } else {
                obj.prop('disabled', true);
                obj.text("("+countdown+"s)后重新发送") ;
                countdown--;
            }
            setTimeout(function() { setTime(obj) },1000) //每1000毫秒执行一次
        }



        $('#send_phone').on('click', function(){
            sendyzm($("#send_phone"));
        });

        form.verify({
            idno: [/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/, '请输入正确的身份证号！']
            ,phone: [/^1[3456789]\d{9}$/, '请输入正确的手机号！']
            ,email: [/^[A-Za-zd0-9]+([-_.][A-Za-zd]+)*@([A-Za-zd]+[-.])+[A-Za-zd]{2,5}$/, '请输入正确的邮箱']
            ,password: [/^(\w){6,20}$/, '密码必须由6-20位（字母、数字、下划线）组成']
            ,username: [/^[a-zA-Z0-9_-]{4,16}$/, '用户名必须由4到16位（字母，数字，下划线，减号）组成']
        });

        form.on('submit(formDemo)', function (data) {
            var phone1 = document.getElementById("phone1").value;
            document.getElementById("L_phone").value = phone1;
            $.post("/user/client/save", data.field, function (res) {
                layer.closeAll('loading');
                if (res.code == 200) {
                    step.next('#stepForm');
                } else {
                    layer.msg(res.msg, {icon: 2});
                }
            }, 'json');
            return false;
        });

        form.on('submit(formDemo2)', function (data) {
            var checkcode = $('#L_pass').val();
            url = "/user/regist/client/"+checkcode;
            $.post(url, data.field, function (res) {
                layer.closeAll('loading');
                if (res.code == 200) {
                    step.next('#stepForm');
                } else {
                    layer.msg(res.msg, {icon: 2});
                }
            }, 'json');
            return false;
        });

        $('.pre').click(function () {
            // step.pre('#stepForm');
        });

        $('.next').click(function () {
            step.next('#stepForm');
        });
    });
</script>
</body>

</html>